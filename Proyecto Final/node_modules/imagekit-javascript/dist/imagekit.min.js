!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ImageKit=t()}(this,(function(){"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function r(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?n(Object(o),!0).forEach((function(n){t(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var o={message:"Missing urlEndpoint during SDK initialization",help:""},i={message:"Invalid transformationPosition parameter",help:""},a={message:"privateKey should not be passed on the client side",help:""},s={message:"Missing file parameter for upload",help:""},p={message:"Missing fileName parameter for upload",help:""},u={message:"Missing authentication endpoint for upload",help:""},l={message:"Missing public key for upload",help:""},c={message:"The authenticationEndpoint you provided timed out in 60 seconds",help:""},f={message:"Request to authenticationEndpoint failed due to network error",help:""},d={message:"Request to ImageKit upload endpoint failed due to network error",help:""},y={message:"Invalid uploadOptions parameter",help:""};function h(e,t,n){"function"==typeof n&&(e?n(t,null):n(null,t))}var g=function(e,t){var n=new XMLHttpRequest;n.timeout=6e4,n.open("GET",e.authenticationEndpoint),n.ontimeout=function(e){h(!0,c,t)},n.onerror=function(){h(!0,f,t)},n.onload=function(){if(200===n.status)try{var e=JSON.parse(n.responseText);h(!1,{signature:e.signature,expire:e.expire,token:e.token},t)}catch(e){h(!0,e,t)}else try{h(!0,JSON.parse(n.responseText),t)}catch(e){h(!0,e,t)}},n.send()},v=function(e,t){var n=new XMLHttpRequest;n.open("POST","https://upload.imagekit.io/api/v1/files/upload"),n.onerror=function(){h(!0,d,t)},n.onload=function(){if(200===n.status){var e=JSON.parse(n.responseText);t(null,e)}else if(200!==n.status)try{t(JSON.parse(n.responseText),null)}catch(e){t(e,null)}},n.send(e)},m=function(e,t,n){if(e)if(e.file)if(e.fileName)if(t.authenticationEndpoint)if(t.publicKey){var o,i=new FormData;for(o in e){var a=e[o];void 0!==a&&("string"==typeof a||"boolean"==typeof a?i.append(o,String(a)):i.append(o,a))}i.append("publicKey",t.publicKey),function(e,t,n){g(t,(function(t,r){if(t)return h(!0,t,n);e.append("signature",(null==r?void 0:r.signature)||""),e.append("expire",String((null==r?void 0:r.expire)||0)),e.append("token",(null==r?void 0:r.token)||""),v(e,(function(e,t){return e?h(!0,e,n):h(!1,t,n)}))}))}(i,r(r({},t),{},{authenticationEndpoint:t.authenticationEndpoint}),n)}else h(!0,l,n);else h(!0,u,n);else h(!0,p,n);else h(!0,s,n);else h(!0,y,n)},b={width:"w",height:"h",aspectRatio:"ar",quality:"q",crop:"c",cropMode:"cm",focus:"fo",x:"x",y:"y",format:"f",radius:"r",background:"bg",border:"b",rotation:"rt",rotate:"rt",blur:"bl",named:"n",overlayImage:"oi",overlayImageAspectRatio:"oiar",overlayImageBackground:"oibg",overlayImageBorder:"oib",overlayImageDPR:"oidpr",overlayImageQuality:"oiq",overlayImageCropping:"oic",overlayImageTrim:"oit",overlayX:"ox",overlayY:"oy",overlayFocus:"ofo",overlayHeight:"oh",overlayWidth:"ow",overlayText:"ot",overlayTextFontSize:"ots",overlayTextFontFamily:"otf",overlayTextColor:"otc",overlayTextTransparency:"oa",overlayAlpha:"oa",overlayTextTypography:"ott",overlayBackground:"obg",overlayTextEncoded:"ote",overlayTextWidth:"otw",overlayTextBackground:"otbg",overlayTextPadding:"otp",overlayTextInnerAlignment:"otia",overlayRadius:"or",progressive:"pr",lossless:"lo",trim:"t",metadata:"md",colorProfile:"cp",defaultImage:"di",dpr:"dpr",effectSharpen:"e-sharpen",effectUSM:"e-usm",effectContrast:"e-contrast",effectGray:"e-grayscale",original:"orig"},w=["path","query"],x=function(){return"path"},O=function(e){return"query"===e.transformationPosition},P=function(e){return void 0!==e.transformationPosition&&-1!=w.indexOf(e.transformationPosition)},T=function(e){return e&&(b[e]||b[e.toLowerCase()])||""},k=function(){return":"},j=function(){return","},E=function(){return"-"};function I(e){return"string"==typeof e&&"/"==e[e.length-1]&&(e=e.substring(0,e.length-1)),e}function S(e,t){var n=t||"/",r=new RegExp(n+"{1,}","g");return e.join(n).replace(r,n)}var R=function(e){if(!e.path&&!e.src)return"";var t,n,r;try{e.path?(r=new URL(e.urlEndpoint).pathname,t=new URL(S([e.urlEndpoint.replace(r,""),e.path]))):(t=new URL(e.src),n=!0)}catch(e){return console.error(e),""}for(var o in e.sdkVersion&&""!=e.sdkVersion.trim()&&t.searchParams.append("ik-sdk-version",e.sdkVersion.trim()),e.queryParameters)t.searchParams.append(o,String(e.queryParameters[o]));var i=function(e){if(!Array.isArray(e))return"";for(var t=[],n=0,r=e.length;n<r;n++){var o=[];for(var i in e[n]){var a=T(i);if(a||(a=i),"-"===e[n][i])o.push(a);else{var s=e[n][i];"oi"!==a&&"di"!==a||(s=(s=I(("string"==typeof(p=s||"")&&"/"==p[0]&&(p=p.slice(1)),p))).replace(/\//g,"@@")),o.push([a,s].join(E()))}}t.push(o.join(j()))}var p;return t.join(k())}(e.transformation);return i&&i.length&&(O(e)||n?t.searchParams.append("tr",i):t.pathname=S(["tr"+k()+i,t.pathname])),t.pathname=S(r?[r,t.pathname]:[t.pathname]),t.href};return function(){function n(e){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t(this,"options",{sdkVersion:"javascript-".concat("1.4.1"),publicKey:"",urlEndpoint:"",transformationPosition:x()}),this.options=r(r({},this.options),e||{}),!this.options.urlEndpoint)throw o;if(function(e){return void 0!==e.privateKey}(this.options))throw a;if(!P(this.options))throw i}var s,p,u;return s=n,(p=[{key:"url",value:function(e){return t=e,n=this.options,R(r(r({},n),t));var t,n}},{key:"upload",value:function(e,t,n){var o=r(r({},this.options),n);return m(e,o,t)}}])&&e(s.prototype,p),u&&e(s,u),n}()}));
